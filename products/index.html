<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tuote - L√∂yt√∂kauppa</title>
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <nav class="navbar">
      <a href="../" class="logo">üõçÔ∏è L√∂yt√∂kauppa</a>
      <div class="nav-links">
        <a href="../" class="nav-link">
          <i class="fas fa-arrow-left"></i>
          Takaisin kauppaan
        </a>
        <div class="cart-icon" onclick="toggleCart()">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-count" id="cartCount">0</span>
        </div>
      </div>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <div class="container">
      <!-- Product Details -->
      <div class="product-details" id="productDetails">
        <!-- Product will be loaded here -->
      </div>
      
      <!-- Product not found message -->
      <div id="productNotFound" class="text-center text-muted" style="display: none;">
        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
        <h2>Tuotetta ei l√∂ytynyt</h2>
        <p>Valitettavasti etsim√§√§si tuotetta ei l√∂ytynyt.</p>
        <a href="../" class="btn btn-primary mt-lg">
          <i class="fas fa-arrow-left"></i>
          Takaisin kauppaan
        </a>
      </div>

      <!-- Related Products -->
      <section class="related-products mt-2xl">
        <h2 class="section-title">Suosittelemme my√∂s</h2>
        <div class="products-grid" id="relatedProducts">
          <!-- Related products will be loaded here -->
        </div>
      </section>
    </div>
  </main>

  <!-- STATUS MESSAGE -->
  <div id="statusMessage" class="status-message"></div>

  <!-- JavaScript -->
  <script src="../products-data.js"></script>
  <script>
    // Get product ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');

    function loadProduct() {
      if (!productId) {
        showProductNotFound();
        return;
      }

      const products = loadProductsFromJSON();
      const product = products.find(p => p.id == productId);
      
      if (!product) {
        showProductNotFound();
        return;
      }

      displayProduct(product);
      loadRelatedProducts(product.category, product.id);
    }

    function displayProduct(product) {
      const container = document.getElementById('productDetails');
      container.innerHTML = `
        <div class="product-hero">
          <div class="product-image-container">
            <div class="product-image-main">
              ${product.image ? 
                `<img src="${product.image}" alt="${product.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                 <div class="product-image-placeholder" style="display: none;">
                   <i class="fas fa-image"></i>
                 </div>` :
                `<div class="product-image-placeholder">
                   <i class="fas fa-image"></i>
                 </div>`
              }
            </div>
          </div>
          
          <div class="product-info-main">
            <div class="product-header">
              <span class="product-category">${product.category}</span>
              <h1 class="product-title">${product.name}</h1>
              <div class="product-price-main">${product.price} ‚Ç¨</div>
            </div>
            
            <div class="product-description">
              <h3>Kuvaus</h3>
              <p>${product.description || 'Ei kuvausta saatavilla.'}</p>
            </div>
            
            <div class="product-actions">
              <div class="quantity-selector">
                <label for="quantity">M√§√§r√§:</label>
                <div class="quantity-controls">
                  <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                  <input type="number" id="quantity" value="1" min="1" max="10">
                  <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
                </div>
              </div>
              
              <button class="btn btn-primary btn-lg" onclick="addToCart(${product.id})">
                <i class="fas fa-shopping-cart"></i>
                Lis√§√§ ostoskoriin
              </button>
              
              <button class="btn btn-secondary" onclick="addToWishlist(${product.id})">
                <i class="fas fa-heart"></i>
                Lis√§√§ toivelistaan
              </button>
            </div>
            
            <div class="product-info-extra">
              <div class="info-item">
                <i class="fas fa-truck"></i>
                <div>
                  <strong>Toimitus</strong>
                  <p>Ilmainen toimitus yli 50‚Ç¨ tilauksille</p>
                </div>
              </div>
              <div class="info-item">
                <i class="fas fa-undo"></i>
                <div>
                  <strong>Palautus</strong>
                  <p>14 p√§iv√§n palautusoikeus</p>
                </div>
              </div>
              <div class="info-item">
                <i class="fas fa-shield-alt"></i>
                <div>
                  <strong>Takuu</strong>
                  <p>2 vuoden valmistajan takuu</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;

      // Update page title
      document.title = `${product.name} - L√∂yt√∂kauppa`;
    }

    function showProductNotFound() {
      document.getElementById('productDetails').style.display = 'none';
      document.getElementById('productNotFound').style.display = 'block';
    }

    function loadRelatedProducts(category, excludeId) {
      const products = loadProductsFromJSON();
      const related = products
        .filter(p => p.category === category && p.id != excludeId)
        .slice(0, 4);
      
      const container = document.getElementById('relatedProducts');
      
      if (related.length === 0) {
        container.parentElement.style.display = 'none';
        return;
      }
      
      container.innerHTML = related.map(product => `
        <div class="product-card" onclick="window.location.href='?id=${product.id}'">
          ${product.image ? 
            `<img src="${product.image}" alt="${product.name}" class="product-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
             <div class="product-image" style="display: none;">üì¶</div>` :
            `<div class="product-image">üì¶</div>`
          }
          <div class="product-info">
            <h3 class="product-title">${product.name}</h3>
            <div class="product-price">${product.price} ‚Ç¨</div>
            <span class="product-category">${product.category}</span>
            <p class="product-description">${(product.description || '').substring(0, 100)}${(product.description || '').length > 100 ? '...' : ''}</p>
          </div>
        </div>
      `).join('');
    }

    function changeQuantity(delta) {
      const input = document.getElementById('quantity');
      const newValue = parseInt(input.value) + delta;
      if (newValue >= 1 && newValue <= 10) {
        input.value = newValue;
      }
    }

    function addToCart(productId) {
      const products = loadProductsFromJSON();
      const product = products.find(p => p.id == productId);
      
      if (!product) {
        showStatus('Tuotetta ei l√∂ytynyt', 'error');
        return;
      }
      
      const quantity = parseInt(document.getElementById('quantity').value);
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      
      const existingItem = cart.find(item => item.id == productId);
      if (existingItem) {
        existingItem.quantity += quantity;
      } else {
        cart.push({
          id: product.id,
          name: product.name,
          price: product.price,
          category: product.category,
          image: product.image,
          quantity: quantity
        });
      }
      
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      showStatus(`${product.name} lis√§tty ostoskoriin!`, 'success');
    }

    function addToWishlist(productId) {
      const products = loadProductsFromJSON();
      const product = products.find(p => p.id == productId);
      
      if (!product) {
        showStatus('Tuotetta ei l√∂ytynyt', 'error');
        return;
      }
      
      let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
      
      if (wishlist.find(item => item.id == productId)) {
        showStatus('Tuote on jo toivelistalla', 'info');
        return;
      }
      
      wishlist.push({
        id: product.id,
        name: product.name,
        price: product.price,
        category: product.category,
        image: product.image
      });
      
      localStorage.setItem('wishlist', JSON.stringify(wishlist));
      showStatus(`${product.name} lis√§tty toivelistaan!`, 'success');
    }

    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const count = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartCount').textContent = count;
    }

    function showStatus(message, type) {
      const statusEl = document.getElementById('statusMessage');
      statusEl.textContent = message;
      statusEl.className = `status-message ${type} show`;
      
      setTimeout(() => {
        statusEl.classList.remove('show');
      }, 3000);
    }

    function toggleCart() {
      // Redirect to checkout page
      window.location.href = '../checkout/';
    }

    // Initialize page
    loadProduct();
    updateCartCount();
  </script>
</body>
</html>
