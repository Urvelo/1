<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Complete System - Demo</title>
  <style>
    body { 
      font-family: system-ui, -apple-system, sans-serif; 
      max-width: 800px; 
      margin: 40px auto; 
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .demo-section { 
      margin: 30px 0; 
      padding: 20px; 
      background: #2a2a2a; 
      border-radius: 8px; 
      border-left: 4px solid #4ecdc4;
    }
    .code-block { 
      background: #0a0a0a; 
      padding: 15px; 
      border-radius: 5px; 
      overflow-x: auto;
      font-family: 'Monaco', 'Courier New', monospace;
    }
    button { 
      background: #4ecdc4; 
      color: #000; 
      border: none; 
      padding: 10px 20px; 
      border-radius: 5px; 
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #45b7b8; }
    input { 
      background: #3a3a3a; 
      border: 1px solid #555; 
      color: #fff; 
      padding: 8px; 
      border-radius: 4px;
      margin: 5px;
    }
    .result { 
      background: #0f3460; 
      padding: 10px; 
      border-radius: 5px; 
      margin: 10px 0;
      font-family: monospace;
    }
    .success { background: #27ae60; color: #fff; }
    .error { background: #e74c3c; color: #fff; }
  </style>
</head>
<body>
  <h1>🔥 Firebase Complete System - Demo</h1>
  <p>Kokonainen valmis Firebase + JS -rakenne kehittäjälle</p>

  <!-- 1. AUTH DEMO -->
  <div class="demo-section">
    <h2>🔐 1. Authentication Demo</h2>
    <div>
      <h3>Rekisteröinti:</h3>
      <input type="email" id="regEmail" placeholder="user@example.com">
      <input type="password" id="regPassword" placeholder="salasana">
      <input type="text" id="regName" placeholder="Nimi">
      <input type="text" id="regAddress" placeholder="Osoite">
      <button onclick="testRegister()">Rekisteröidy</button>
    </div>
    
    <div>
      <h3>Kirjautuminen:</h3>
      <input type="email" id="loginEmail" placeholder="user@example.com">
      <input type="password" id="loginPassword" placeholder="salasana">
      <button onclick="testLogin()">Kirjaudu</button>
      <button onclick="testLogout()">Kirjaudu ulos</button>
    </div>
    
    <div class="result" id="authResult">Auth-tulokset näkyvät tässä...</div>
  </div>

  <!-- 2. PRODUCTS DEMO -->
  <div class="demo-section">
    <h2>📦 2. Products Demo</h2>
    <button onclick="loadProducts()">Lataa tuotteet</button>
    <button onclick="addSampleProduct()">Lisää esimerkkituote</button>
    <div class="result" id="productsResult">Tuotteet näkyvät tässä...</div>
  </div>

  <!-- 3. ORDERS DEMO -->
  <div class="demo-section">
    <h2>🛒 3. Orders Demo</h2>
    <button onclick="createSampleOrder()">Luo esimerkkitilaus</button>
    <button onclick="loadUserOrders()">Lataa omat tilaukset</button>
    <div class="result" id="ordersResult">Tilaukset näkyvät tässä...</div>
  </div>

  <!-- 4. COMPLETE FLOW DEMO -->
  <div class="demo-section">
    <h2>💳 4. Complete Shopping Flow</h2>
    <div id="paypal-button-container"></div>
    <button onclick="startShoppingFlow()">Aloita ostosprosessi</button>
    <div class="result" id="flowResult">Ostosprosessi tulos...</div>
  </div>

  <!-- 5. CODE EXAMPLES -->
  <div class="demo-section">
    <h2>💻 5. Koodiesimerkit kehittäjälle</h2>
    
    <h3>Firebase-kokoelmien rakenne:</h3>
    <div class="code-block">
<pre>📁 Firestore Collections:
├── 👥 customers/
│   └── [userId] → { name, email, address, phone, createdAt }
├── 📦 products/
│   └── [productId] → { name, price, image, stock, category, description }
└── 📋 orders/
    └── [orderId] → { userId, items[], total, status, paymentId, createdAt }</pre>
    </div>

    <h3>Käyttöesimerkit:</h3>
    <div class="code-block">
<pre>// 1️⃣ Rekisteröinti + Customer-luonti
const result = await AuthManager.register("user@test.com", "password123", {
  name: "Matti Meikäläinen",
  address: "Esimerkkikatu 1, Helsinki",
  phone: "+358401234567"
});

// 2️⃣ Tuotteiden haku
const products = await ProductManager.getAllProducts();

// 3️⃣ Tilauksen luonti
const cart = [
  { id: "prod1", name: "Tuote 1", price: 19.99, quantity: 2 },
  { id: "prod2", name: "Tuote 2", price: 29.99, quantity: 1 }
];
const { orderId } = await OrderManager.createOrder(cart);

// 4️⃣ PayPal-maksu
PaymentManager.initPayPalButtons(orderId, 69.97, onSuccess, onError);

// 5️⃣ Sähköpostivahvistus
await EmailManager.sendOrderConfirmation(orderData);</pre>
    </div>
  </div>

  <!-- Firebase SDK:t -->
  <script type="module" src="firebase-complete-system.js"></script>
  
  <!-- PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AQxc4TuX-gJFHG-Y8G6WEWyxMj0yjFLqxFd8HdKDn-E4JU4wgIg8HNRXqHlQN8CqQp1KrVV1mV6qTu5z&currency=EUR"></script>
  
  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  
  <script>
    // Demo-funktiot
    let currentUser = null;
    
    // Auth state kuuntelu
    window.FirebaseCompleteSystem?.AuthManager.onAuthStateChanged((user) => {
      currentUser = user;
      updateAuthResult(`🔄 Auth state: ${user ? 'Kirjautunut - ' + user.email : 'Ei kirjautunut'}`);
    });

    async function testRegister() {
      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;
      const name = document.getElementById('regName').value;
      const address = document.getElementById('regAddress').value;
      
      updateAuthResult("⏳ Rekisteröidään...");
      
      const result = await window.FirebaseCompleteSystem.AuthManager.register(email, password, {
        name, address
      });
      
      updateAuthResult(result.success ? 
        `✅ Rekisteröinti onnistui: ${result.user.email}` : 
        `❌ Virhe: ${result.error}`
      );
    }

    async function testLogin() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      updateAuthResult("⏳ Kirjaudutaan...");
      
      const result = await window.FirebaseCompleteSystem.AuthManager.login(email, password);
      
      updateAuthResult(result.success ? 
        `✅ Kirjautuminen onnistui: ${result.user.email}` : 
        `❌ Virhe: ${result.error}`
      );
    }

    async function testLogout() {
      const result = await window.FirebaseCompleteSystem.AuthManager.logout();
      updateAuthResult(result.success ? "✅ Uloskirjautuminen onnistui" : "❌ Virhe uloskirjautumisessa");
    }

    async function loadProducts() {
      updateProductsResult("⏳ Ladataan tuotteita...");
      try {
        const products = await window.FirebaseCompleteSystem.ProductManager.getAllProducts();
        updateProductsResult(`✅ Tuotteita ladattu: ${products.length}\n${JSON.stringify(products, null, 2)}`);
      } catch (error) {
        updateProductsResult(`❌ Virhe: ${error.message}`);
      }
    }

    async function addSampleProduct() {
      if (!currentUser) {
        updateProductsResult("❌ Kirjaudu sisään ensin");
        return;
      }
      
      updateProductsResult("⏳ Lisätään tuote...");
      try {
        const productId = await window.FirebaseCompleteSystem.ProductManager.addProduct({
          id: `prod_${Date.now()}`,
          name: "Esimerkkituote",
          price: 19.99,
          image: "https://via.placeholder.com/200",
          stock: 10,
          category: "Elektroniikka",
          description: "Tämä on esimerkkituote"
        });
        updateProductsResult(`✅ Tuote lisätty: ${productId}`);
      } catch (error) {
        updateProductsResult(`❌ Virhe: ${error.message}`);
      }
    }

    async function createSampleOrder() {
      if (!currentUser) {
        updateOrdersResult("❌ Kirjaudu sisään ensin");
        return;
      }
      
      updateOrdersResult("⏳ Luodaan tilaus...");
      try {
        const cart = [
          { id: "prod1", name: "Testtituote 1", price: 19.99, quantity: 2 },
          { id: "prod2", name: "Testtituote 2", price: 29.99, quantity: 1 }
        ];
        
        const { orderId } = await window.FirebaseCompleteSystem.OrderManager.createOrder(cart, {
          name: "Testikäyttäjä",
          address: "Testiosoite 123"
        });
        
        updateOrdersResult(`✅ Tilaus luotu: ${orderId}`);
      } catch (error) {
        updateOrdersResult(`❌ Virhe: ${error.message}`);
      }
    }

    async function loadUserOrders() {
      if (!currentUser) {
        updateOrdersResult("❌ Kirjaudu sisään ensin");
        return;
      }
      
      updateOrdersResult("⏳ Ladataan tilauksia...");
      try {
        const orders = await window.FirebaseCompleteSystem.OrderManager.getUserOrders();
        updateOrdersResult(`✅ Tilauksia: ${orders.length}\n${JSON.stringify(orders, null, 2)}`);
      } catch (error) {
        updateOrdersResult(`❌ Virhe: ${error.message}`);
      }
    }

    async function startShoppingFlow() {
      if (!currentUser) {
        updateFlowResult("❌ Kirjaudu sisään ensin");
        return;
      }
      
      updateFlowResult("⏳ Aloitetaan ostosprosessi...");
      
      const cart = [
        { id: "demo1", name: "Demo-tuote 1", price: 19.99, quantity: 1 },
        { id: "demo2", name: "Demo-tuote 2", price: 29.99, quantity: 1 }
      ];
      
      const customerInfo = {
        name: "Demo Käyttäjä",
        address: "Demo-osoite 123, Helsinki"
      };
      
      try {
        const result = await window.FirebaseCompleteSystem.ShoppingFlow.processOrder(cart, customerInfo);
        updateFlowResult(result.success ? 
          `✅ Ostosprosessi aloitettu. Tilaus ID: ${result.orderId}\n🎯 PayPal-napit näkyvät yllä` : 
          `❌ Virhe: ${result.error}`
        );
      } catch (error) {
        updateFlowResult(`❌ Virhe: ${error.message}`);
      }
    }

    // Helper functions
    function updateAuthResult(text) {
      document.getElementById('authResult').textContent = text;
    }
    
    function updateProductsResult(text) {
      document.getElementById('productsResult').textContent = text;
    }
    
    function updateOrdersResult(text) {
      document.getElementById('ordersResult').textContent = text;
    }
    
    function updateFlowResult(text) {
      document.getElementById('flowResult').textContent = text;
    }

    // EmailJS init
    if (window.emailjs) {
      emailjs.init("user_abc456");
    }
  </script>
</body>
</html>