<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>K√§ytt√§j√§profiili - L√∂yt√∂kauppa</title>
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <nav class="navbar">
      <a href="../" class="logo">üõçÔ∏è L√∂yt√∂kauppa</a>
      <div class="nav-links">
        <a href="../" class="nav-link">
          <i class="fas fa-arrow-left"></i>
          Takaisin kauppaan
        </a>
      </div>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <div class="container">
      <!-- Profile Header -->
      <div class="text-center mb-xl">
        <h1 class="text-primary mb-sm">
          <i class="fas fa-user-circle"></i>
          K√§ytt√§j√§profiili
        </h1>
        <p class="text-muted">Hallitse tietojasi ja tilauksiasi</p>
      </div>

      <!-- Profile Card -->
      <div class="card mb-xl">
        <div class="card-header">
          <h2 class="text-primary">
            <i class="fas fa-user"></i>
            Perustiedot
          </h2>
        </div>
        <div class="card-body">
          <div class="grid-cols-2">
            <div class="form-group">
              <label>Nimi</label>
              <input type="text" id="profileName" class="form-input" placeholder="Kirjoita nimesi">
            </div>
            <div class="form-group">
              <label>S√§hk√∂posti</label>
              <input type="email" id="profileEmail" class="form-input" placeholder="email@esimerkki.fi" readonly>
            </div>
            <div class="form-group">
              <label>Puhelinnumero</label>
              <input type="tel" id="profilePhone" class="form-input" placeholder="+358 40 123 4567">
            </div>
            <div class="form-group">
              <label>Osoite</label>
              <input type="text" id="profileAddress" class="form-input" placeholder="Katuosoite 123">
            </div>
          </div>
          <button class="btn btn-primary mt-lg" onclick="updateProfile()">
            <i class="fas fa-save"></i>
            Tallenna muutokset
          </button>
        </div>
      </div>

      <!-- Order History -->
      <div class="card mb-xl">
        <div class="card-header">
          <h2 class="text-primary">
            <i class="fas fa-shopping-bag"></i>
            Tilaushistoria
          </h2>
        </div>
        <div class="card-body">
          <div id="orderHistory">
            <div class="text-center text-muted">
              <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
              <p>Ei tilauksia viel√§</p>
              <a href="../" class="btn btn-primary mt-md">
                <i class="fas fa-shopping-cart"></i>
                Aloita ostokset
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Account Settings -->
      <div class="card mb-xl">
        <div class="card-header">
          <h2 class="text-primary">
            <i class="fas fa-cog"></i>
            Tilin asetukset
          </h2>
        </div>
        <div class="card-body">
          <div class="grid-cols-2">
            <div class="form-group">
              <label>Uusi salasana</label>
              <input type="password" id="newPassword" class="form-input" placeholder="Uusi salasana">
            </div>
            <div class="form-group">
              <label>Vahvista salasana</label>
              <input type="password" id="confirmPassword" class="form-input" placeholder="Vahvista salasana">
            </div>
          </div>
          <div class="flex gap-md mt-lg">
            <button class="btn btn-warning" onclick="changePassword()">
              <i class="fas fa-key"></i>
              Vaihda salasana
            </button>
            <button class="btn btn-danger" onclick="confirmDeleteAccount()">
              <i class="fas fa-trash"></i>
              Poista tili
            </button>
          </div>
        </div>
      </div>

      <!-- Logout -->
      <div class="text-center">
        <button class="btn btn-secondary" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i>
          Kirjaudu ulos
        </button>
      </div>
    </div>
  </main>

  <!-- STATUS MESSAGE -->
  <div id="statusMessage" class="status-message"></div>

  <!-- JavaScript -->
  <script>
    // Check if user is logged in
    const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
    
    if (!currentUser) {
      window.location.href = '../login/';
    }

    // Load user profile data
    function loadProfile() {
      if (currentUser) {
        document.getElementById('profileName').value = currentUser.name || '';
        document.getElementById('profileEmail').value = currentUser.email || '';
        document.getElementById('profilePhone').value = currentUser.phone || '';
        document.getElementById('profileAddress').value = currentUser.address || '';
      }
    }

    // Update profile
    function updateProfile() {
      const name = document.getElementById('profileName').value;
      const phone = document.getElementById('profilePhone').value;
      const address = document.getElementById('profileAddress').value;

      if (currentUser) {
        currentUser.name = name;
        currentUser.phone = phone;
        currentUser.address = address;
        
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        showStatus('Profiili p√§ivitetty onnistuneesti!', 'success');
      }
    }

    // Change password
    function changePassword() {
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      if (!newPassword || !confirmPassword) {
        showStatus('T√§yt√§ molemmat salasanakent√§t', 'error');
        return;
      }

      if (newPassword !== confirmPassword) {
        showStatus('Salasanat eiv√§t t√§sm√§√§', 'error');
        return;
      }

      if (newPassword.length < 6) {
        showStatus('Salasanan tulee olla v√§hint√§√§n 6 merkki√§', 'error');
        return;
      }

      showStatus('Salasana vaihdettu onnistuneesti!', 'success');
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmPassword').value = '';
    }

    // Delete account confirmation
    function confirmDeleteAccount() {
      if (confirm('Oletko varma ett√§ haluat poistaa tilisi? T√§t√§ toimintoa ei voi peruuttaa.')) {
        localStorage.removeItem('currentUser');
        showStatus('Tili poistettu', 'info');
        setTimeout(() => {
          window.location.href = '../';
        }, 2000);
      }
    }

    // Logout
    function logout() {
      localStorage.removeItem('currentUser');
      showStatus('Kirjauduttu ulos', 'info');
      setTimeout(() => {
        window.location.href = '../';
      }, 1000);
    }

    // Show status message
    function showStatus(message, type) {
      const statusEl = document.getElementById('statusMessage');
      statusEl.textContent = message;
      statusEl.className = `status-message ${type} show`;
      
      setTimeout(() => {
        statusEl.classList.remove('show');
      }, 3000);
    }

    // Load profile on page load
    loadProfile();
  </script>
</body>
</html>
