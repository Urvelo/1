<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kassalle - L√∂yt√∂kauppa</title>
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <nav class="navbar">
      <a href="../" class="logo">üõçÔ∏è L√∂yt√∂kauppa</a>
      <div class="nav-links">
        <a href="../" class="nav-link">
          <i class="fas fa-arrow-left"></i>
          Takaisin kauppaan
        </a>
      </div>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <div class="container">
      <!-- Checkout Header -->
      <div class="text-center mb-xl">
        <h1 class="text-primary mb-sm">
          <i class="fas fa-shopping-cart"></i>
          Kassalle
        </h1>
        <p class="text-muted">Viimeistele tilauksesi</p>
      </div>

      <!-- Checkout Steps -->
      <div class="checkout-steps mb-xl">
        <div class="step active">
          <i class="fas fa-shopping-cart"></i>
          <span>Ostoskori</span>
        </div>
        <div class="step">
          <i class="fas fa-user"></i>
          <span>Tiedot</span>
        </div>
        <div class="step">
          <i class="fas fa-credit-card"></i>
          <span>Maksu</span>
        </div>
        <div class="step">
          <i class="fas fa-check"></i>
          <span>Valmis</span>
        </div>
      </div>

      <!-- Cart Contents -->
      <div class="grid-cols-3 gap-xl">
        <!-- Cart Items -->
        <div class="checkout-section" style="grid-column: 1 / 3;">
          <div class="card">
            <div class="card-header">
              <h2 class="text-primary">
                <i class="fas fa-shopping-bag"></i>
                Ostoskori
              </h2>
            </div>
            <div class="card-body">
              <div id="cartItems">
                <!-- Cart items will be loaded here -->
              </div>
              <div id="emptyCart" class="text-center text-muted" style="display: none;">
                <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <p>Ostoskorisi on tyhj√§</p>
                <a href="../" class="btn btn-primary mt-md">
                  <i class="fas fa-shopping-cart"></i>
                  Aloita ostokset
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="checkout-section">
          <div class="card">
            <div class="card-header">
              <h3 class="text-primary">
                <i class="fas fa-receipt"></i>
                Tilauksen yhteenveto
              </h3>
            </div>
            <div class="card-body">
              <div class="order-summary">
                <div class="summary-row">
                  <span>Tuotteet:</span>
                  <span id="subtotal">0,00 ‚Ç¨</span>
                </div>
                <div class="summary-row">
                  <span>Toimitus:</span>
                  <span id="shipping">Ilmainen</span>
                </div>
                <div class="summary-row">
                  <span>ALV (24%):</span>
                  <span id="tax">0,00 ‚Ç¨</span>
                </div>
                <hr>
                <div class="summary-row total">
                  <strong>
                    <span>Yhteens√§:</span>
                    <span id="total">0,00 ‚Ç¨</span>
                  </strong>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Customer Information -->
      <div class="card mb-xl">
        <div class="card-header">
          <h2 class="text-primary">
            <i class="fas fa-user"></i>
            Asiakastiedot
          </h2>
        </div>
        <div class="card-body">
          <div class="grid-cols-2">
            <div class="form-group">
              <label for="firstName">Etunimi *</label>
              <input type="text" id="firstName" class="form-input" required>
            </div>
            <div class="form-group">
              <label for="lastName">Sukunimi *</label>
              <input type="text" id="lastName" class="form-input" required>
            </div>
            <div class="form-group">
              <label for="email">S√§hk√∂posti *</label>
              <input type="email" id="email" class="form-input" required>
            </div>
            <div class="form-group">
              <label for="phone">Puhelinnumero</label>
              <input type="tel" id="phone" class="form-input">
            </div>
            <div class="form-group" style="grid-column: 1 / -1;">
              <label for="address">Osoite *</label>
              <input type="text" id="address" class="form-input" required>
            </div>
            <div class="form-group">
              <label for="city">Kaupunki *</label>
              <input type="text" id="city" class="form-input" required>
            </div>
            <div class="form-group">
              <label for="postalCode">Postinumero *</label>
              <input type="text" id="postalCode" class="form-input" required>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Method -->
      <div class="card mb-xl">
        <div class="card-header">
          <h2 class="text-primary">
            <i class="fas fa-credit-card"></i>
            Maksutapa
          </h2>
        </div>
        <div class="card-body">
          <div class="payment-methods">
            <label class="payment-option">
              <input type="radio" name="payment" value="card" checked>
              <div class="payment-card">
                <i class="fas fa-credit-card"></i>
                <span>Luottokortti</span>
              </div>
            </label>
            <label class="payment-option">
              <input type="radio" name="payment" value="paypal">
              <div class="payment-card">
                <i class="fab fa-paypal"></i>
                <span>PayPal</span>
              </div>
            </label>
            <label class="payment-option">
              <input type="radio" name="payment" value="bank">
              <div class="payment-card">
                <i class="fas fa-university"></i>
                <span>Pankkisiirto</span>
              </div>
            </label>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="checkout-actions text-center">
        <button class="btn btn-success btn-lg" onclick="processCheckout()" id="checkoutBtn">
          <i class="fas fa-lock"></i>
          Vahvista ja maksa
        </button>
        <div class="mt-md">
          <a href="../" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i>
            Jatka ostoksia
          </a>
        </div>
      </div>
    </div>
  </main>

  <!-- STATUS MESSAGE -->
  <div id="statusMessage" class="status-message"></div>

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>K√§sitell√§√§n tilausta...</p>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // Load cart from localStorage
    function loadCart() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const cartItemsContainer = document.getElementById('cartItems');
      const emptyCartMessage = document.getElementById('emptyCart');
      
      if (cart.length === 0) {
        cartItemsContainer.style.display = 'none';
        emptyCartMessage.style.display = 'block';
        return;
      }
      
      cartItemsContainer.style.display = 'block';
      emptyCartMessage.style.display = 'none';
      
      cartItemsContainer.innerHTML = cart.map(item => `
        <div class="cart-item">
          <div class="item-info">
            <h4>${item.name}</h4>
            <p class="text-muted">${item.category}</p>
          </div>
          <div class="item-quantity">
            <span>M√§√§r√§: ${item.quantity}</span>
          </div>
          <div class="item-price">
            <strong>${(item.price * item.quantity).toFixed(2)} ‚Ç¨</strong>
          </div>
        </div>
      `).join('');
      
      updateOrderSummary(cart);
    }

    function updateOrderSummary(cart) {
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const tax = subtotal * 0.24;
      const total = subtotal + tax;
      
      document.getElementById('subtotal').textContent = subtotal.toFixed(2) + ' ‚Ç¨';
      document.getElementById('tax').textContent = tax.toFixed(2) + ' ‚Ç¨';
      document.getElementById('total').textContent = total.toFixed(2) + ' ‚Ç¨';
    }

    function processCheckout() {
      // Validate form
      const requiredFields = ['firstName', 'lastName', 'email', 'address', 'city', 'postalCode'];
      const missing = requiredFields.filter(field => !document.getElementById(field).value.trim());
      
      if (missing.length > 0) {
        showStatus('T√§yt√§ kaikki pakolliset kent√§t', 'error');
        return;
      }
      
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      if (cart.length === 0) {
        showStatus('Ostoskorisi on tyhj√§', 'error');
        return;
      }
      
      // Show loading
      document.getElementById('loadingOverlay').style.display = 'flex';
      
      // Simulate payment processing
      setTimeout(() => {
        // Clear cart
        localStorage.removeItem('cart');
        
        // Hide loading
        document.getElementById('loadingOverlay').style.display = 'none';
        
        // Show success message
        showStatus('Tilaus vahvistettu! Kiitos ostoksestasi.', 'success');
        
        // Redirect to home page after 3 seconds
        setTimeout(() => {
          window.location.href = '../';
        }, 3000);
      }, 2000);
    }

    function showStatus(message, type) {
      const statusEl = document.getElementById('statusMessage');
      statusEl.textContent = message;
      statusEl.className = `status-message ${type} show`;
      
      setTimeout(() => {
        statusEl.classList.remove('show');
      }, 3000);
    }

    // Load user data if logged in
    function loadUserData() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      if (currentUser) {
        document.getElementById('firstName').value = currentUser.name?.split(' ')[0] || '';
        document.getElementById('lastName').value = currentUser.name?.split(' ')[1] || '';
        document.getElementById('email').value = currentUser.email || '';
        document.getElementById('phone').value = currentUser.phone || '';
        document.getElementById('address').value = currentUser.address || '';
      }
    }

    // Initialize page
    loadCart();
    loadUserData();
  </script>
</body>
</html>
